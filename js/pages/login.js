$(function () {
    
    $('.k-getcode').on('click',sendSms)


    function sendSms(){
        if (isMob($('.k-pnumber').val())){
            if (itv){
                return
            }
            $('.k-getcode').off('click')
            var times = 60
            var itv = setInterval(function(){
                $('.k-getcode').text('重新获取('+(times --) +')' )
                if (times === 0){

                    clearInterval(itv)
                    $('.k-getcode').text('获取验证码')
                    $('.k-getcode').on('click',sendSms)
                }
            },1000)

        }
    }

    function isMob(val){
        if ($.trim(val) === ''){
            $.alert('请输入手机号码')
            return false;            
        }

        if (/\d+/ig.test($.trim(val))){
            return true 
        }

    }

    $('.k-pcode').picker({
        toolbarTemplate: '<header class="bar bar-nav">\
        <button class="button button-link pull-left close-picker">取消</button>\
        <button class="button button-link pull-right close-picker">确定</button>\
        <h1 class="title">国际电话区号</h1>\
        </header>',
        cols: [{
            textAlign: 'center',
            values: ['+86',
                '+355',
                '+213',
                '+376',
                '+244',
                '+1264',
                '+1268',
                '+54',
                '+374',
                '+247',
                '+61',
                '+43',
                '+994',
                '+1242',
                '+973',
                '+1246',
                '+32',
                '+501',
                '+229',
                '+1441',
                '+267',
                '+55',
                '+673',
                '+359',
                '+226',
                '+257',
                '+855',
                '+1',
                '+1345',
                '+56',
                '+86',
                '+57',
                '+682',
                '+506',
                '+357',
                '+420',
                '+45',
                '+253',
                '+1809',
                '+20',
                '+503',
                '+372',
                '+251',
                '+679',
                '+358',
                '+33',
                '+594',
                '+689',
                '+241',
                '+220',
                '+995',
                '+49',
                '+233',
                '+350',
                '+30',
                '+1473',
                '+1671',
                '+502',
                '+592',
                '+509',
                '+504',
                '+852',
                '+36',
                '+354',
                '+91',
                '+62',
                '+353',
                '+972',
                '+39',
                '+1876',
                '+81',
                '+962',
                '+7',
                '+254',
                '+82',
                '+965',
                '+996',
                '+856',
                '+371',
                '+266',
                '+423',
                '+370',
                '+352',
                '+261',
                '+265',
                '+60',
                '+960',
                '+223',
                '+356',
                '+223',
                '+596',
                '+230',
                '+52',
                '+373',
                '+377',
                '+976',
                '+1664',
                '+212',
                '+258',
                '+264',
                '+674',
                '+977',
                '+599',
                '+31',
                '+64',
                '+505',
                '+227',
                '+234',
                '+47',
                '+968',
                '+507',
                '+675',
                '+595',
                '+51',
                '+63',
                '+48',
                '+351',
                '+1',
                '+974',
                '+262',
                '+40',
                '+7',
                '+1758',
                '+1784',
                '+685',
                '+685',
                '+378',
                '+239',
                '+966',
                '+221',
                '+248',
                '+232',
                '+65',
                '+421',
                '+386',
                '+677',
                '+27',
                '+27',
                '+34',
                '+94',
                '+1758',
                '+1784',
                '+597',
                '+268',
                '+46',
                '+41',
                '+886',
                '+992',
                '+255',
                '+66',
                '+228',
                '+676',
                '+1868',
                '+216',
                '+993',
                '+256',
                '+380',
                '+971',
                '+44',
                '+598',
                '+998',
                '+58',
                '+84',
                '+338',
                '+243',
                '+260'
            ]
        }]
    });
})